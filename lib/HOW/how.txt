# 부동산 관리 앱 세부 프로세스 분석

## 🔄 핵심 프로세스 흐름

### 1. 주소 검색 프로세스
```
사용자 입력 → AddressService → 도로명주소 API → 결과 파싱 → UI 표시
```

**세부 코드 흐름:**
- `home_page.dart:180` - 사용자가 주소 입력 후 검색 버튼 클릭
- `address_service.dart:20` - `searchRoadAddress()` 메서드 실행
- `address_service.dart:30` - 도로명주소 API URL 구성 (juso.go.kr)
- `address_service.dart:40` - HTTP GET 요청으로 주소 검색
- `address_service.dart:60` - JSON 응답 파싱하여 주소 목록 반환
- `home_page.dart:200` - 검색 결과를 UI에 표시

### 2. 주소 파싱 프로세스
```
도로명주소 → AddressParser → 시/도/시군구/도로명/건물번호 분리
```

**세부 코드 흐름:**
- `address_parser.dart:4` - `parseAddress1st()` 메서드로 1차 파싱
- `address_parser.dart:15` - RegionConstants.sidoSigunguMap에서 시/도 매칭
- `address_parser.dart:25` - 정규식으로 도로명과 건물번호 분리
- `address_parser.dart:52` - `parseDetailAddress()` 메서드로 동/호 파싱
- `address_parser.dart:60` - "제211동 제15,16층 제1506호" 형식 파싱

### 3. 등기부등본 조회 프로세스
```
파싱된 주소 → RegisterService → CODEF API → 소유자 검증 → 결과 표시
```

**세부 코드 흐름:**
- `home_page.dart:220` - `searchRegister()` 메서드 실행
- `home_page.dart:230` - 동/호 필수 체크
- `register_service.dart:15` - `getCodefAccessToken()` 메서드로 토큰 발급
- `register_service.dart:60` - `getRealEstateRegister()` 메서드 실행
- `register_service.dart:80` - RSA 암호화로 비밀번호 암호화
- `register_service.dart:100` - CODEF API POST 요청
- `home_page.dart:70` - `checkOwnerName()` 메서드로 소유자 검증
- `owner_parser.dart:1` - `extractOwnerNames()` 메서드로 소유자 이름 추출

### 4. 계약서 작성 프로세스
```
등기부등본 데이터 → CurrentStateParser → 자동 폼 입력 → 사용자 수정 → PDF 생성
```

**세부 코드 흐름:**
- `home_page.dart:120` - `saveRegisterDataToDatabase()` 메서드 실행
- `current_state_parser.dart:100` - `parseCurrentState()` 메서드로 JSON 파싱
- `current_state_parser.dart:120` - Header, Ownership, Areas 정보 추출
- `contract_input_form.dart:30` - `_autoFillFromParsedData()` 메서드로 자동 입력
- `contract_input_form.dart:40` - 소유자 정보 자동 채움
- `contract_input_form.dart:50` - 부동산 정보 자동 채움
- `contract_input_form.dart:60` - 건물 구조 정제 및 면적 파싱
- `contract_input_form.dart:150` - 폼 UI 구성 및 사용자 입력 수집

### 5. 상세 내용 입력 프로세스
```
기본 계약서 → WhathouseDetailFormScreen → 상세 정보 입력 → 저장
```

**세부 코드 흐름:**
- `whathouse_detail_form.dart:200` - 수도, 전기, 가스, 난방 등 상세 입력
- `whathouse_detail_form.dart:250` - 각 항목별 라디오 버튼 및 텍스트 필드
- `whathouse_detail_form.dart:300` - 폼 데이터 수집 및 검증
- `whathouse_detail_form.dart:50` - `_submitForm()` 메서드로 저장

### 6. 매물 관리 프로세스
```
Property 모델 생성 → 메모리 저장 → 목록 표시 → 상세 정보 표시
```

**세부 코드 흐름:**
- `home_page.dart:140` - Property 객체 생성
- `property.dart:1` - Property 모델 정의 (id, address, transactionType, price 등)
- `home_page.dart:50` - `_addProperty()` 메서드로 메모리 저장
- `main.dart:350` - HouseMarketPage에서 매물 목록 표시
- `main.dart:380` - ListView.builder로 매물 카드 렌더링
- `main.dart:400` - 등기부등본 데이터에서 가격 정보 파싱

## 🔧 핵심 서비스 분석

### AddressService (주소 검색)
- **파일**: `lib/services/address_service.dart`
- **주요 메서드**: `searchRoadAddress()`, `getAddressDetail()`
- **API**: 도로명주소 API (juso.go.kr)
- **키워드**: 4자 이상 필수, 페이지네이션 지원

### RegisterService (등기부등본 조회)
- **파일**: `lib/services/register_service.dart`
- **주요 메서드**: `getCodefAccessToken()`, `getRealEstateRegister()`, `rsaEncrypt()`
- **API**: CODEF API (등기부등본 조회)
- **모드**: 실제 API / 테스트 모드 (testcase.txt)

### CurrentStateParser (등기부등본 파싱)
- **파일**: `lib/utils/current_state_parser.dart`
- **주요 클래스**: Header, Ownership, LandArea, BuildingArea, Lien
- **기능**: JSON을 구조화된 객체로 변환

## 📊 데이터 모델 분석

### Property 모델
```dart
class Property {
  final int? id;                    // SQLite ID
  final String address;             // 부동산 주소
  final String transactionType;     // 거래 유형
  final int price;                  // 가격
  final String registerData;        // 등기부등본 원본 JSON
  final String registerSummary;     // 등기부등본 요약 정보
  final String contractStatus;      // 계약 상태
  final String mainContractor;      // 대표 계약자
  final String contractor;          // 계약자
  final DateTime createdAt;         // 생성일
}
```

## 🎯 핵심 기능별 세부 로직

### 1. 소유자 검증 로직
- **파일**: `lib/utils/owner_parser.dart`
- **패턴**: "소유자+홍길동", "소유자: 홍길동"
- **검증**: 로그인 사용자와 등기부등본 소유자 일치 여부

### 2. 주소 파싱 로직
- **1차 파싱**: 시/도, 시군구, 도로명, 건물번호 분리
- **2차 파싱**: 동/호 정보 추출
- **정규식**: 복잡한 주소 형식 지원

### 3. 계약서 자동 입력 로직
- **소유자 정보**: 등기부등본에서 자동 추출
- **부동산 정보**: 주소, 면적, 구조 정보 자동 입력
- **정제**: 불필요한 법조문, 특수문자 제거

### 4. 매물 관리 로직
- **저장**: 현재 메모리 기반 (DB 미연동)
- **표시**: ListView.builder로 카드 형태 표시
- **파싱**: 등기부등본 JSON에서 가격 정보 추출

## 🚀 실행 흐름 요약

1. **로그인** (test/1234) → **메인페이지**
2. **내집팔기** → **주소검색** → **등기부등본조회** → **계약서작성**
3. **계약서작성** → **기본정보입력** → **상세내용입력** → **저장**
4. **계약관리** → **작성된 계약서 목록**
5. **내집사기** → **매물 목록 표시**

## ⚠️ 주요 제약사항

- **데이터베이스**: 메모리 기반 저장 (앱 재시작 시 데이터 손실)
- **API 키**: 하드코딩된 테스트 키 사용
- **보안**: 실제 운영 환경 보안 강화 필요
- **에러 처리**: 네트워크 오류 처리 개선 필요 