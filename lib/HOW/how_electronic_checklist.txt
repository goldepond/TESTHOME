# 확인·설명서 전자체크 시스템 상세 가이드

## 📋 시스템 개요

### 목적
가계약/계약 전에 중개사가 의무적으로 알려야 하는 정보를 앱에서 체크리스트로 확인하고, 
모든 항목이 완료되어야만 결제·가계약이 진행되도록 하는 시스템입니다.

### 핵심 특징
- **"말로만 OK"가 아닌 증빙 첨부 필수**
- **전자확인서가 PDF로 보관**되어 분쟁 시 증거로 활용
- **진행률 실시간 표시** (예: 0/8)
- **상태별 구분**: 제출됨/미제출/보완필요/승인됨
- **보완 필요 사유 명확히 기록**

## 🎯 사용자 관점 설명

### 언제 보이나요?
매물 상세 페이지 → **[가계약/예약]** 버튼 클릭 시 게이트 화면이 먼저 열립니다.

### 화면 구성
1. **상단 경고 메시지**: "확인·설명서가 100% 완료되면 가계약으로 이동합니다."
2. **진행률 표시**: 0/8 형태로 완료된 항목 수 표시
3. **체크리스트 카드들**: 각 항목별 상태와 액션 버튼
4. **하단 버튼들**: PDF 다운로드, 가계약 진행

## 📝 체크리스트 항목 예시

### 1. 집주인 체납세 고지
- **설명**: 완납증명서 캡처/파일 업로드
- **카테고리**: 세무
- **필수 서류**: 체납세 완납증명서

### 2. 선순위 권리관계 요약
- **설명**: 근저당·설정일·말소 여부 확인
- **카테고리**: 권리관계
- **필수 서류**: 등기부등본, 근저당권 설정/말소 증명서

### 3. 전입 가능 여부
- **설명**: 불법용도·다가구/다세대 유의사항
- **카테고리**: 용도
- **필수 서류**: 건축물대장, 용도변경 허가서

### 4. 관리비 상세
- **설명**: 포함/제외 항목 명시
- **카테고리**: 관리비
- **필수 서류**: 관리비 내역서, 관리규약

### 5. 하자·수리 의무 안내
- **설명**: 보일러·전기·상하수도 등
- **카테고리**: 하자
- **필수 서류**: 점검보고서, 수리이력서

### 6. 확정일자/전입신고 협조 동의
- **설명**: 임차인 권리보호를 위한 협조사항
- **카테고리**: 권리보호
- **필수 서류**: 협조동의서

### 7. 부동산 중개업소 등록증
- **설명**: 공인중개사 등록증 사본
- **카테고리**: 중개업소
- **필수 서류**: 중개업소 등록증

### 8. 중개보조원 자격증
- **설명**: 중개보조원 자격증 사본 (해당시)
- **카테고리**: 중개업소
- **필수 서류**: 중개보조원 자격증

## 🔄 상태별 동작

### 미제출 (회색)
- **표시**: 회색 아이콘, "미제출" 배지
- **액션**: "파일 업로드" 버튼 활성화
- **다음 단계**: 파일 업로드 후 "제출됨"으로 변경

### 제출됨 (파란색)
- **표시**: 파란색 아이콘, "제출됨" 배지
- **액션**: 업로드된 파일 정보 표시
- **다음 단계**: 중개보조원 검토 후 "승인됨" 또는 "보완필요"

### 보완필요 (빨간색)
- **표시**: 빨간색 아이콘, "보완필요" 배지
- **액션**: 보완 필요 사유 표시, "파일 업로드" 버튼 활성화
- **다음 단계**: 수정된 파일 재업로드

### 승인됨 (초록색)
- **표시**: 초록색 아이콘, "승인됨" 배지
- **액션**: 읽기 전용, 수정 불가
- **다음 단계**: 최종 완료

## 👥 역할별 권한

### 일반 사용자 (임차인/임대인)
- 파일 업로드 가능
- 보완 필요 사유 확인 가능
- PDF 다운로드 가능
- 모든 항목 완료 시 가계약 진행 가능

### 중개보조원 모드
- **"보조원 응대"** 배지 표시
- 제출된 항목에 대해 "보완요청" 또는 "승인" 가능
- 보완 필요 사유 입력 가능
- 대표 공인중개사 확인 서명 추가 요구

## 🛡️ 예외·보호장치

### 미완료 항목 처리
- 미완료 항목이 있으면 **결제 버튼 비활성화**
- 진행률이 100%가 아니면 가계약 진행 불가

### 중개보조원 응대 시
- **"보조원 응대"** 배지 노출
- 대표 공인중개사 확인 서명 추가 요구
- 보완 요청 시 사유 필수 입력

### 증거 보관
- 모든 확인 내역은 **시간·IP가 찍힌 PDF**로 보관
- 분쟁 시 법적 증거로 활용 가능
- 업로드 시간, 담당자 정보 기록

## 📱 화면 문구 예시

### 상단 경고
```
⚠️ 확인·설명서가 100% 완료되면 가계약으로 이동합니다.
```

### 카드 내부 정보
```
📎 자료 출처 · 업로드 시간 · 담당자(보조원/대표) 표시
```

### 하단 안내
```
📄 PDF 내려받기(임차인 보관용)
💼 가계약 진행 (모든 항목 완료 시 활성화)
```

### 보완 필요 사유 예시
```
❌ 업로드된 완납증명서의 해상도가 낮아 식별이 불가능합니다. 
   재업로드 바랍니다.
```

## 🔧 기술적 구현

### 파일 업로드
- **지원 형식**: JPG, JPEG, PNG, PDF
- **저장 위치**: Firebase Storage
- **메타데이터**: 업로드 시간, 사용자, IP 주소

### 상태 관리
- **로컬 상태**: Flutter StatefulWidget
- **서버 동기화**: Firestore 실시간 업데이트
- **백업**: 로컬 SQLite 캐시

### PDF 생성
- **라이브러리**: pdf 패키지
- **포함 정보**: 모든 체크리스트 항목, 상태, 파일 정보
- **보안**: 시간·IP 스탬프, 디지털 서명

## 📊 진행률 계산

### 완료 조건
- **승인됨**: 중개보조원이 승인한 항목
- **제출됨**: 파일이 업로드되어 검토 대기 중인 항목

### 진행률 공식
```
진행률 = (승인됨 + 제출됨) / 전체 항목 수 × 100%
```

### 가계약 진행 조건
```
모든 항목이 "승인됨" 상태여야 함
```

## 🎯 사용 시나리오

### 시나리오 1: 일반 사용자
1. 매물 상세에서 "가계약/예약" 클릭
2. 전자체크리스트 화면 진입
3. 각 항목별로 파일 업로드
4. 모든 항목 완료 시 "가계약 진행" 버튼 활성화
5. PDF 다운로드 후 가계약 진행

### 시나리오 2: 중개보조원
1. 제출된 항목 검토
2. 문제가 있으면 "보완요청" + 사유 입력
3. 정상이면 "승인" 처리
4. 모든 항목 승인 시 대표 서명 요구

### 시나리오 3: 보완 필요
1. "보완필요" 상태인 항목 확인
2. 보완 필요 사유 읽기
3. 수정된 파일 재업로드
4. 다시 검토 대기

## 🔍 품질 관리

### 파일 검증
- **파일 크기**: 최대 10MB
- **파일 형식**: 이미지(JPG, PNG), 문서(PDF)
- **해상도**: 이미지 최소 300DPI 권장

### 내용 검증
- **중개보조원**: 파일 내용 검토
- **자동 검증**: 파일 형식, 크기 체크
- **수동 검증**: 전문가 검토 필요

### 보안
- **접근 권한**: 역할별 권한 관리
- **데이터 암호화**: 민감 정보 암호화
- **감사 로그**: 모든 작업 기록

## 📈 향후 개선 사항

### 자동화
- OCR을 통한 문서 내용 자동 추출
- AI를 통한 문서 진위 여부 자동 판단
- 자동 알림 시스템

### 확장성
- 추가 체크리스트 항목 동적 추가
- 커스텀 체크리스트 템플릿
- 다국어 지원

### 통합
- 부동산 중개업소 관리 시스템 연동
- 정부 기관 API 연동
- 법무사/변호사 시스템 연동

