# 전체 시스템 로직 정리

> **작성일:** 2024-11-01  
> **MVP 버전:** 1.0  
> **목적:** 판매자와 공인중개사 각각의 플로우 완전 분석

---

## 📋 목차

1. [판매자 플로우 (완전)](#1-판매자-플로우-완전)
2. [공인중개사 플로우 (완전)](#2-공인중개사-플로우-완전)
3. [데이터 흐름도](#3-데이터-흐름도)
4. [시스템 아키텍처](#4-시스템-아키텍처)

---

## 1. 판매자 플로우 (완전)

### 🚪 **1단계: 사이트 접속**

```
┌─────────────────────────────────────────┐
│  판매자가 앱/웹 접속                      │
│  URL: https://yoursite.com              │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  AuthGate에서 인증 상태 확인             │
│  - 로그인 상태: MainPage로 이동          │
│  - 비로그인: HomePage로 이동 (로그인 불필요)│
└─────────────────────────────────────────┘
```

**접속 경로:**
- **앱:** 앱 실행 → `_AuthGate` → `MainPage` 또는 `HomePage`
- **웹:** 브라우저 접속 → `_AuthGate` → `MainPage` 또는 `HomePage`

**로그인 여부:**
- ✅ **비로그인 가능:** 주소 검색, 공인중개사 찾기, 전화 걸기
- ❌ **로그인 필요:** 견적 요청, 견적 이력 확인

---

### 🏠 **2단계: 주소 입력 및 검색**

```
┌─────────────────────────────────────────┐
│  HomePage (내집팔기 탭)                   │
│  📍 주소 검색창                            │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  사용자가 주소 입력                       │
│  예: "서울시 강남구 테헤란로 152"          │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  "조회하기" 버튼 클릭                     │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  Juso API 호출                           │
│  - 도로명 주소 검색                       │
│  - 결과 목록 표시 (페이지네이션)          │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  사용자가 주소 선택                      │
│  예: "서울특별시 강남구 테헤란로 152"      │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  VWorld API 호출                         │
│  - 좌표 변환 (위도/경도)                  │
│  - 아파트 정보 조회                       │
│  - 단지 정보 표시                         │
└─────────────────────────────────────────┘
```

**조회 결과:**
- ✅ 도로명 주소
- ✅ 지번 주소
- ✅ 좌표 (위도, 경도)
- ✅ 아파트 단지 정보 (면적, 구조 등)
- ✅ 단지 건물 정보

---

### 🏢 **3단계: 공인중개사 찾기**

```
┌─────────────────────────────────────────┐
│  "공인중개사 찾기" 버튼 클릭              │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  BrokerListPage로 이동                   │
│  - 주소, 좌표 전달                        │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  VWorld API + 서울시 API 병렬 호출       │
│  ┌─────────────────┐  ┌──────────────┐  │
│  │ VWorld API       │  │ 서울시 API    │  │
│  │ - 주변 중개사 검색│  │ - 중개사 정보 │  │
│  │ - 거리 계산      │  │ - 행정처분    │  │
│  └─────────────────┘  └──────────────┘  │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  데이터 통합 및 정렬                      │
│  - 거리순 정렬 (가까운 순)                │
│  - 중복 제거                              │
│  - 행정처분 이력 병합                     │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  공인중개사 목록 표시                     │
│  ┌──────────────────────────────────┐   │
│  │ [공인중개사 A]                     │   │
│  │ - 사무소명: ○○부동산               │   │
│  │ - 거리: 0.5km                      │   │
│  │ - 전화번호: 02-1234-5678           │   │
│  │ - 영업상태: 영업중                  │   │
│  │ [전화문의] [비대면문의]             │   │
│  └──────────────────────────────────┘   │
│  ┌──────────────────────────────────┐   │
│  │ [공인중개사 B]                     │   │
│  │ ...                                │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**표시 정보:**
- 사무소명, 대표자명
- 전화번호
- 거리 (1km, 2km 등)
- 영업 상태 (영업중/폐업 등)
- 행정처분 이력 (있는 경우만)
- 주소 (도로명, 지번)

---

### 💬 **4단계: 견적 요청 (2가지 방법)**

#### **방법 A: 개별 견적 요청**

```
┌─────────────────────────────────────────┐
│  공인중개사 카드에서 "비대면문의" 클릭    │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  로그인 체크                              │
│  - 로그인 안 됨: 로그인 다이얼로그        │
│  - 로그인 됨: 견적 요청 폼 열기          │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  견적 요청 폼 (_QuoteRequestFormPage)     │
│  ┌──────────────────────────────────┐   │
│  │ 매물 정보 (자동 입력)              │   │
│  │ - 주소: 서울시 강남구...           │   │
│  │ - 면적: 84㎡                      │   │
│  │                                   │   │
│  │ 특이사항                           │   │
│  │ - 세입자 여부: [ ] 있음 [✓] 없음   │   │
│  │ - 희망가: [___________]           │   │
│  │ - 목표기간: [___________]          │   │
│  │ - 특이사항: [___________]          │   │
│  │                                   │   │
│  │        [중개 제안 요청하기]        │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  사용자가 정보 입력 후 "요청하기" 클릭   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  QuoteRequest 객체 생성                  │
│  {                                      │
│    userId: "user123",                   │
│    userName: "홍길동",                  │
│    brokerName: "○○부동산",              │
│    propertyAddress: "서울시...",         │
│    desiredPrice: "11억",                │
│    status: "pending",                   │
│    ...                                  │
│  }                                      │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  Firebase 저장                           │
│  - Collection: "quoteRequests"          │
│  - Document ID: 자동 생성                │
│  - 고유 링크 ID 생성 (inquiryLinkId)    │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  성공 메시지 표시                         │
│  "○○부동산에 제안 요청이 전송되었습니다!" │
└─────────────────────────────────────────┘
```

#### **방법 B: 여러 곳 동시 견적 요청 (MVP 핵심)** ✨

```
┌─────────────────────────────────────────┐
│  공인중개사 목록 페이지                   │
│  우측 상단 "여러 곳 선택" 버튼 클릭       │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  선택 모드 활성화                         │
│  - 카드에 체크박스 표시                   │
│  - 액션 버튼 숨김                         │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  사용자가 여러 중개사 체크                │
│  ┌──────────────────────────────────┐   │
│  │ [✓] 공인중개사 A                  │   │
│  │ [✓] 공인중개사 B                  │   │
│  │ [✓] 공인중개사 C                  │   │
│  │ [ ] 공인중개사 D                  │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  하단 고정 버튼 표시                      │
│  "선택한 3곳에 견적 요청"                 │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  일괄 견적 요청 다이얼로그                │
│  ┌──────────────────────────────────┐   │
│  │ 3곳에 견적 요청                    │   │
│  │                                   │   │
│  │ 매물 정보 (자동 입력)              │   │
│  │ - 주소: 서울시...                  │   │
│  │                                   │   │
│  │ 매물 유형: [아파트 ▼]              │   │
│  │ 세입자 여부: [ ] 있음 [✓] 없음     │   │
│  │ 희망가: [___________]             │   │
│  │ 목표기간: [___________]            │   │
│  │ 특이사항: [___________]            │   │
│  │                                   │   │
│  │   [취소]    [요청하기]             │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  정보 한 번만 입력 후 "요청하기" 클릭     │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  선택한 모든 중개사에게 반복 요청          │
│  ┌──────────────────────────────────┐   │
│  │ for (broker in selectedBrokers) {│   │
│  │   1. QuoteRequest 객체 생성        │   │
│  │   2. Firebase 저장                │   │
│  │   3. 고유 링크 생성                │   │
│  │ }                                 │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  결과 메시지                              │
│  "3곳에 견적 요청 완료"                   │
│  - 성공: 3곳                             │
│  - 실패: 0곳                             │
└─────────────────────────────────────────┘
```

**Firebase 저장 구조:**
```javascript
// quoteRequests 컬렉션
{
  userId: "user123",
  userName: "홍길동",
  userEmail: "홍길동@example.com",
  brokerName: "○○부동산",
  brokerRegistrationNumber: "123-45-67890",
  brokerRoadAddress: "서울시 강남구...",
  message: "매도자 입찰카드 제안 요청",
  status: "pending",
  requestDate: Timestamp,
  propertyAddress: "서울시 강남구...",
  propertyArea: "84㎡",
  propertyType: "아파트",
  hasTenant: false,
  desiredPrice: "11억",
  targetPeriod: "2~3개월",
  specialNotes: "조용한 곳 원함",
  inquiryLinkId: "abc123def456",  // 고유 링크 ID
  brokerEmail: null,  // Admin이 나중에 추가
  emailAttachedAt: null,
  // 중개업자 답변 필드 (아직 null)
  recommendedPrice: null,
  minimumPrice: null,
  brokerAnswer: null,
  answerDate: null,
}
```

---

### 📋 **5단계: 견적 이력 확인**

```
┌─────────────────────────────────────────┐
│  공인중개사 목록 페이지 또는 MainPage    │
│  우측 상단 "견적 이력" 아이콘 클릭       │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  QuoteHistoryPage로 이동                 │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  Firebase에서 견적문의 조회              │
│  - Collection: "quoteRequests"         │
│  - 필터: userName == "홍길동"            │
│  - 정렬: requestDate DESC (최신순)      │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  견적 목록 표시                          │
│  ┌──────────────────────────────────┐   │
│  │ [답변대기] ○○부동산               │   │
│  │ 2024.11.01 14:30                │   │
│  │ 주소: 서울시 강남구...            │   │
│  │ 희망가: 11억                      │   │
│  └──────────────────────────────────┘   │
│  ┌──────────────────────────────────┐   │
│  │ [답변완료] △△부동산               │   │
│  │ 2024.10.30 10:20                │   │
│  │ 예상 금액: 11억 5천만원           │   │
│  │ 상담 시간: 평일 오후 가능        │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**필터 옵션:**
- 전체
- 답변대기 (`status == 'pending'`)
- 답변완료 (`status == 'completed'` 또는 답변 있음)

---

### 📊 **6단계: 견적 비교 (MVP 핵심)** ✨

```
┌─────────────────────────────────────────┐
│  견적 이력 페이지                        │
│  우측 상단 "견적 비교" 버튼 클릭          │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  답변 완료된 견적 필터링                 │
│  - recommendedPrice 또는 minimumPrice 있는 것만│
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  견적이 없으면 안내 메시지                │
│  "비교할 견적이 없습니다.                 │
│   공인중개사로부터 답변을 받으면          │
│   비교할 수 있습니다."                   │
└─────────────────────────────────────────┘
           ↓ (견적이 있으면)
┌─────────────────────────────────────────┐
│  QuoteComparisonPage로 이동              │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  가격 추출 및 정렬                        │
│  - "11억 5천만원" → 115000000           │
│  - "2.5억" → 250000000                  │
│  - 최저가, 평균가, 최고가 계산           │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  견적 비교 화면 표시                      │
│  ┌──────────────────────────────────┐   │
│  │ ┌───────┐ ┌───────┐ ┌───────┐  │   │
│  │ │최저가 │ │평균가 │ │최고가 │  │   │
│  │ │ 2.3억 │ │ 2.4억 │ │ 2.5억 │  │   │
│  │ └───────┘ └───────┘ └───────┘  │   │
│  │                                 │   │
│  │ ┌───────────────────────────┐  │   │
│  │ │ [최저가] △△부동산 ⭐       │  │   │
│  │ │ 예상 금액: 2억 3천만원     │  │   │
│  │ │ 예상 거래기간: 2~3개월     │  │   │
│  │ └───────────────────────────┘  │   │
│  │ ┌───────────────────────────┐  │   │
│  │ │ ○○부동산                   │  │   │
│  │ │ 예상 금액: 2억 4천만원     │  │   │
│  │ └───────────────────────────┘  │   │
│  │ ┌───────────────────────────┐  │   │
│  │ │ [최고가] □□부동산          │  │   │
│  │ │ 예상 금액: 2억 5천만원     │  │   │
│  │ └───────────────────────────┘  │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**비교 기능:**
- ✅ 최저가/평균가/최고가 요약 카드
- ✅ 최저가 견적 초록색 강조
- ✅ 가격, 거래기간, 수수료율 비교
- ✅ 한눈에 비교 가능한 UI

---

## 2. 공인중개사 플로우 (완전)

### 📧 **1단계: 견적 요청 수신**

```
┌─────────────────────────────────────────┐
│  관리자가 견적 요청 확인                  │
│  (Admin Dashboard)                       │
│  ┌──────────────────────────────────┐   │
│  │ 견적 요청 목록                     │   │
│  │ - 요청자: 홍길동                   │   │
│  │ - 중개사: ○○부동산                │   │
│  │ - 상태: pending                   │   │
│  │                                   │   │
│  │ [공인중개사 이메일 추가]           │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  관리자가 중개사 이메일 입력              │
│  예: broker@example.com                  │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  Firebase 업데이트                       │
│  - brokerEmail: "broker@example.com"    │
│  - emailAttachedAt: 현재 시간            │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  관리자가 이메일/문자 발송                │
│  (수동 또는 자동화 시스템)                │
│  ┌──────────────────────────────────┐   │
│  │ 제목: 매물 견적 요청               │   │
│  │                                   │   │
│  │ 안녕하세요, ○○부동산입니다.        │   │
│  │                                   │   │
│  │ 부동산 매물 견적 요청이           │   │
│  │ 들어왔습니다. 아래 링크를          │   │
│  │ 클릭하여 답변해주세요.             │   │
│  │                                   │   │
│  │ 링크:                              │   │
│  │ https://yoursite.com/inquiry/    │   │
│  │       abc123def456                │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**고유 링크 구조:**
```
https://yoursite.com/inquiry/{inquiryLinkId}
예: https://yoursite.com/inquiry/abc123def456
```

---

### 🔗 **2단계: 링크 접속**

```
┌─────────────────────────────────────────┐
│  공인중개사가 이메일/문자의 링크 클릭     │
│  또는 URL 직접 입력                       │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  URL 파싱                                │
│  /inquiry/{linkId}                      │
│  예: /inquiry/abc123def456              │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  main.dart의 onGenerateRoute 처리        │
│  ┌──────────────────────────────────┐   │
│  │ if (path.startsWith('/inquiry/')) │   │
│  │   → BrokerInquiryResponsePage    │   │
│  │      (linkId: "abc123def456")     │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

**중요:** 공인중개사는 **로그인 불필요!** 링크만 있으면 접속 가능 ✅

---

### 📝 **3단계: 견적 요청 확인**

```
┌─────────────────────────────────────────┐
│  BrokerInquiryResponsePage 로드          │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  Firebase에서 견적문의 조회              │
│  - Collection: "quoteRequests"          │
│  - 필터: inquiryLinkId == "abc123..."   │
│  - 조건: status == "pending"            │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  견적 요청 정보 표시                      │
│  ┌──────────────────────────────────┐   │
│  │ 매물 정보                          │   │
│  │ - 주소: 서울시 강남구 테헤란로 152 │   │
│  │ - 면적: 84㎡                      │   │
│  │ - 매물 유형: 아파트                │   │
│  │                                   │   │
│  │ 요청자 정보                        │   │
│  │ - 이름: 홍길동                    │   │
│  │ - 이메일: 홍길동@example.com      │   │
│  │                                   │   │
│  │ 특이사항                           │   │
│  │ - 세입자: 없음                     │   │
│  │ - 희망가: 11억                    │   │
│  │ - 목표기간: 2~3개월               │   │
│  │ - 특이사항: 조용한 곳 원함         │   │
│  │                                   │   │
│  │ 요청일: 2024.11.01 14:30          │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

---

### ✍️ **4단계: 견적 답변 작성**

```
┌─────────────────────────────────────────┐
│  중개 제안 입력 폼                        │
│  ┌──────────────────────────────────┐   │
│  │ 중개 제안                          │   │
│  │                                   │   │
│  │ 권장 매도가                        │   │
│  │ [___________________]             │   │
│  │ 예: 11억 5천만원                   │   │
│  │                                   │   │
│  │ 최저수락가                         │   │
│  │ [___________________]             │   │
│  │ 예: 11억                           │   │
│  │                                   │   │
│  │ 예상 거래기간                       │   │
│  │ [___________________]             │   │
│  │ 예: 2~3개월                       │   │
│  │                                   │   │
│  │ 홍보 방법                          │   │
│  │ [___________________]             │   │
│  │ 예: 온라인+오프라인 동시            │   │
│  │                                   │   │
│  │ 수수료 제안율                      │   │
│  │ [___________________]             │   │
│  │ 예: 0.5%                           │   │
│  │                                   │   │
│  │ 최근 유사 거래 사례                 │   │
│  │ [___________________]             │   │
│  │ 예: 근처 아파트 84㎡ 11.2억...     │   │
│  │                                   │   │
│  │ 추가 메시지                         │   │
│  │ [___________________]             │   │
│  │ [___________________]             │   │
│  │                                   │   │
│  │      [취소]  [답변 제출]           │   │
│  └──────────────────────────────────┘   │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  공인중개사가 정보 입력 후 "답변 제출"    │
└─────────────────────────────────────────┘
```

---

### 💾 **5단계: 답변 저장**

```
┌─────────────────────────────────────────┐
│  Firebase 업데이트                       │
│  - recommendedPrice: "11억 5천만원"      │
│  - minimumPrice: "11억"                 │
│  - expectedDuration: "2~3개월"          │
│  - promotionMethod: "온라인+오프라인"   │
│  - commissionRate: "0.5%"              │
│  - recentCases: "근처 아파트 84㎡..."    │
│  - brokerAnswer: "추가 메시지..."        │
│  - status: "completed"                  │
│  - answerDate: 현재 시간                 │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  성공 메시지                              │
│  "답변이 성공적으로 제출되었습니다!"      │
│  "요청자에게 알림이 전송됩니다."          │
└─────────────────────────────────────────┘
```

**업데이트된 데이터 구조:**
```javascript
{
  // ... 기존 필드 ...
  recommendedPrice: "11억 5천만원",  // ✅ 추가됨
  minimumPrice: "11억",              // ✅ 추가됨
  expectedDuration: "2~3개월",       // ✅ 추가됨
  promotionMethod: "온라인+오프라인", // ✅ 추가됨
  commissionRate: "0.5%",            // ✅ 추가됨
  recentCases: "근처 아파트...",      // ✅ 추가됨
  brokerAnswer: "추가 메시지...",     // ✅ 추가됨
  status: "completed",                // ✅ 변경됨
  answerDate: Timestamp,              // ✅ 추가됨
}
```

---

### 🔔 **6단계: 판매자 알림 (향후)**

```
┌─────────────────────────────────────────┐
│  판매자에게 알림 전송                     │
│  (현재는 수동 확인 필요)                  │
│                                           │
│  향후 구현:                              │
│  - 푸시 알림                              │
│  - 이메일 알림                            │
│  - 앱 내 알림 배지                        │
└─────────────────────────────────────────┘
           ↓
┌─────────────────────────────────────────┐
│  판매자가 견적 이력 확인                  │
│  → [5단계: 견적 이력 확인] 참조          │
└─────────────────────────────────────────┘
```

---

## 3. 데이터 흐름도

### 전체 시스템 흐름

```
┌──────────────┐
│   판매자     │
└──────┬───────┘
       │
       │ 1. 주소 입력
       ▼
┌──────────────┐
│  HomePage    │
│  - Juso API  │
│  - VWorld    │
└──────┬───────┘
       │
       │ 2. 공인중개사 찾기
       ▼
┌──────────────┐
│BrokerListPage│
│- VWorld API  │
│- 서울시 API  │
└──────┬───────┘
       │
       │ 3. 견적 요청
       ▼
┌──────────────┐         ┌──────────────┐
│   Firebase   │────────▶│  quoteReqs   │
│  Firestore   │         │  컬렉션      │
└──────┬───────┘         └──────┬───────┘
       │                        │
       │ 4. 고유 링크 생성       │
       │                        │
       │                        ▼
       │              ┌──────────────┐
       │              │  관리자      │
       │              │  이메일 발송 │
       │              └──────┬───────┘
       │                     │
       │                     │ 5. 링크 수신
       │                     ▼
       │              ┌──────────────┐
       │              │ 공인중개사    │
       │              │ 링크 클릭     │
       │              └──────┬───────┘
       │                     │
       │                     │ 6. 답변 작성
       │                     ▼
       │              ┌──────────────┐
       │              │   Firebase   │
       │              │   업데이트   │
       │              └──────┬───────┘
       │                     │
       │                     │ 7. 상태 변경
       │                     │    pending → completed
       │                     │
       │                     │
       │ 8. 견적 확인        │
       ▼                     │
┌──────────────┐             │
│QuoteHistoryPage           │
└──────┬───────┘             │
       │                     │
       │ 9. 견적 비교        │
       ▼                     │
┌──────────────┐             │
│QuoteComparisonPage         │
│ - 최저/평균/최고가          │
│ - 상세 비교                │
└────────────────────────────┘
```

---

## 4. 시스템 아키텍처

### 기술 스택

```
┌─────────────────────────────────────────┐
│  프론트엔드                              │
│  - Flutter (Web + Mobile)               │
│  - Dart                                  │
└──────┬──────────────────────────────────┘
       │
       │ HTTP Requests
       │
┌──────┴──────────────────────────────────┐
│  백엔드                                  │
│  - Firebase Authentication               │
│  - Firebase Firestore                    │
└──────┬──────────────────────────────────┘
       │
       │ External APIs
       │
┌──────┴──────────────────────────────────┐
│  외부 API                                │
│  - Juso API (주소 검색)                   │
│  - VWorld API (좌표, 중개사 정보)        │
│  - 서울시 API (중개사 정보)               │
│  - data.go.kr (아파트 정보)              │
└─────────────────────────────────────────┘
```

### Firebase 컬렉션 구조

```
Firestore
├── users (사용자 정보)
│   └── {userId}
│       ├── email
│       ├── userName
│       ├── firstZone
│       └── frequentLocation
│
├── quoteRequests (견적 요청) ⭐ 핵심
│   └── {requestId}
│       ├── userId
│       ├── userName
│       ├── brokerName
│       ├── propertyAddress
│       ├── status (pending/completed)
│       ├── inquiryLinkId (고유 링크)
│       ├── recommendedPrice (중개사 답변)
│       └── ...
│
├── properties (부동산 정보)
│   └── {propertyId}
│
└── chat_messages (채팅)
    └── {messageId}
```

### 주요 화면 및 라우팅

```
_AuthGate
├── HomePage (비로그인 가능)
│   ├── 주소 검색
│   └── → BrokerListPage
│
├── MainPage (로그인 필요)
│   ├── HomePage (내집팔기)
│   ├── HouseMarketPage (내집사기)
│   ├── HouseManagementPage (내집관리)
│   └── PersonalInfoPage (내 정보)
│
├── BrokerListPage
│   ├── 공인중개사 목록
│   ├── → _QuoteRequestFormPage (개별 요청)
│   └── → _MultipleQuoteRequestDialog (일괄 요청)
│
├── QuoteHistoryPage
│   └── → QuoteComparisonPage (견적 비교)
│
└── BrokerInquiryResponsePage (공인중개사용)
    └── /inquiry/{linkId} (비로그인 접속)
```

---

## 5. 핵심 기능 요약

### 판매자 관점

| 기능 | 설명 | 로그인 필요 |
|------|------|------------|
| 주소 검색 | Juso API로 주소 입력 | ❌ |
| 공인중개사 찾기 | VWorld + 서울시 API | ❌ |
| 전화 걸기 | 원클릭 전화 연결 | ❌ |
| 개별 견적 요청 | 1개 중개사에 요청 | ✅ |
| **여러 견적 요청** | **여러 중개사에 동시 요청** | ✅ |
| 견적 이력 확인 | 요청한 견적 목록 | ✅ |
| **견적 비교** | **최저/평균/최고가 비교** | ✅ |

### 공인중개사 관점

| 기능 | 설명 | 로그인 필요 |
|------|------|------------|
| 링크 접속 | 이메일 링크 클릭 | ❌ |
| 견적 요청 확인 | 매물 정보, 요청자 정보 | ❌ |
| 견적 답변 작성 | 권장가, 거래기간 등 입력 | ❌ |
| 답변 제출 | Firebase 업데이트 | ❌ |

---

## 6. 보안 및 접근 제어

### 접근 제어 정책

| 기능 | 접근 제어 | 설명 |
|------|----------|------|
| 주소 검색 | 공개 | 누구나 사용 가능 |
| 공인중개사 찾기 | 공개 | 누구나 사용 가능 |
| 견적 요청 | 인증 필요 | 로그인 필수 |
| 견적 이력 | 인증 필요 | 본인 것만 조회 |
| 공인중개사 답변 | 링크 기반 | `inquiryLinkId`만 알면 접근 |

### 데이터 보안

- ✅ Firebase Authentication (사용자 인증)
- ✅ Firestore Security Rules (데이터 접근 제어)
- ✅ 고유 링크 ID (무작위 문자열, 예측 불가능)
- ⚠️ HTTPS 필수 (운영 환경)

---

## 7. 향후 개선 사항

### 단기 (1-2주)

- [ ] 이메일 자동 발송 시스템
- [ ] 푸시 알림 (Firebase Cloud Messaging)
- [ ] 공인중개사 추천 순위 알고리즘 개선

### 중기 (1-2개월)

- [ ] 공인중개사 대시보드 (로그인 후 요청 관리)
- [ ] 채팅 기능
- [ ] 리뷰/평점 시스템

### 장기 (3개월+)

- [ ] AI 기반 가격 추천
- [ ] 부동산 시세 분석
- [ ] 계약 진행 관리 시스템

---

## 📝 결론

### MVP 핵심 가치

1. **판매자 편의성**
   - ✅ 여러 중개사 동시 선택 → 시간 절약 70%
   - ✅ 견적 비교 자동화 → 의사결정 빠름

2. **공인중개사 편의성**
   - ✅ 비로그인 접속 → 설치 불필요
   - ✅ 간단한 답변 폼 → 응답률 향상

3. **플랫폼 가치**
   - ✅ 양측 연결 효율화
   - ✅ 견적 비교로 투명성 확보

---

**문서 버전:** 1.0  
**최종 업데이트:** 2024-11-01

